# Команды для проверки сетевых соединений, портов и адресов

## 1. Просмотр сетевых интерфейсов и IP-адресов

### `ip a` (или `ip addr`)
**Назначение:** Отображение информации о сетевых интерфейсах и назначенных IP-адресах.

**Вывод включает:**
- Список всех сетевых интерфейсов (eth0, wlan0, lo и т.д.)
- MAC-адреса (link/ether)
- IPv4 и IPv6 адреса
- Состояние интерфейса (UP/DOWN)
- MTU (Maximum Transmission Unit)

**Пример использования:**
```bash
ip a
# или с цветным выводом
ip -c a
```

**Ключевые поля:**
- `inet` - IPv4 адрес
- `inet6` - IPv6 адрес  
- `state UP` - интерфейс активен
- `mtu` - максимальный размер пакета

## 2. Проверка базовой связности

### `ping 8.8.8.8`
**Назначение:** Проверка доступности удаленного хоста по IP-адресу.

**Что показывает:**
- Время ответа (RTT - Round Trip Time)
- Потерю пакетов
- Стабильность соединения

**Опции:**
```bash
ping -c 5 8.8.8.8    # Отправить 5 пакетов
ping -i 2 8.8.8.8    # Интервал 2 секунды
ping -s 1000 8.8.8.8 # Размер пакета 1000 байт
```

### `ping google.com`
**Назначение:** Проверка DNS-резолвинга и доступности по доменному имени.

**Диагностика проблем:**
- Если `ping 8.8.8.8` работает, а `ping google.com` - нет: **проблема с DNS**
- Если оба не работают: **проблема с сетевым соединением**

## 3. Трассировка маршрута

### `traceroute 8.8.8.8`
**Назначение:** Определение пути пакета до целевого хоста.

**Принцип работы:** Отправляет пакеты с постепенно увеличивающимся TTL (Time to Live)

**Что показывает:**
- Все промежуточные маршрутизаторы (хопы)
- Время отклика каждого узла
- Где именно происходит обрыв связи

**Опции:**
```bash
traceroute -n 8.8.8.8    # Без DNS-резолвинга (только IP)
traceroute -w 2 8.8.8.8  # Таймаут 2 секунды
```

### `mtr 8.8.8.8` (My Traceroute)
**Назначение:** Комбинированная утилита - traceroute + ping в реальном времени.

**Преимущества перед traceroute:**
- Обновление статистики в реальном времени
- Показывает потерю пакетов на каждом хопе
- Более точная диагностика проблем

**Использование:**
```bash
mtr 8.8.8.8           # Интерактивный режим
mtr -r -c 10 8.8.8.8 # Отчет после 10 пакетов
mtr --report-wide 8.8.8.8
```

## 4. Просмотр сетевых соединений и портов

### `netstat -tulpn`
**Назначение:** Отображение всех слушающих портов и активных соединений.

**Ключи:**
- `-t` - TCP соединения
- `-u` - UDP соединения  
- `-l` - только слушающие порты
- `-p` - показать процесс/программу
- `-n` - числовой вывод (без DNS-резолвинга)

**Анализ вывода:**
- **Proto** - протокол (tcp/udp)
- **Local Address** - локальный адрес:порт
- **Foreign Address** - удаленный адрес:порт
- **State** - состояние соединения
- **PID/Program** - процесс использующий порт

### Альтернатива: `ss -tulpn`
**Более современная замена netstat:**
```bash
ss -tulpn            # Аналогично netstat
ss -tunp             # Все активные соединения
```

## 5. Просмотр таблицы маршрутизации

### `netstat -rn` или `ip route`
**Назначение:** Отображение таблицы маршрутизации.

**Ключевые поля:**
- **Destination** - сеть назначения
- **Gateway** - шлюз для маршрута
- **Genmask** - маска сети
- **Flags** - флаги маршрута
- **Iface** - интерфейс

**Альтернатива:**
```bash
ip route show        # Более современная команда
route -n            # Устаревший аналог
```

## 6. Диагностика HTTP/HTTPS соединений

### `curl -Lv`
**Назначение:** Детальная диагностика HTTP-запросов.

**Ключи:**
- `-L` - следовать редиректам
- `-v` - подробный вывод (verbose)
- `-I` - только заголовки (HEAD запрос)

**Что показывает:**
- DNS-резолвинг
- Установление TCP-соединения
- SSL/TLS handshake (для HTTPS)
- HTTP-заголовки запроса и ответа
- Коды ответа и редиректы

**Примеры:**
```bash
curl -Lv https://google.com        # Диагностика HTTPS
curl -I https://example.com        # Проверка заголовков
curl -v --connect-timeout 5 http://example.com
```

## Дополнительные полезные команды

### Проверка DNS
```bash
nslookup google.com
dig google.com
cat /etc/resolv.conf    # Проверка DNS-серверов
```

### Проверка скорости сети
```bash
speedtest-cli          # Тест скорости интернета
iperf3 -c server_ip    # Тест пропускной способности
```

### Анализ сетевого трафика
```bash
tcpdump -i eth0 -c 10  # Перехват пакетов
iftop                   # Просмотр трафика в реальном времени
```

## Типичные сценарии диагностики

### 1. "Сайт не открывается"
```bash
ping site.com
traceroute site.com
curl -Lv site.com
netstat -tulpn | grep :80
```

### 2. "Нет интернета"
```bash
ip a                   # Проверка IP-адреса
ping 8.8.8.8           # Проверка внешней связи
netstat -rn            # Проверка маршрута по умолчанию
cat /etc/resolv.conf   # Проверка DNS
```

### 3. "Сервис не доступен извне"
```bash
netstat -tulpn | grep :port
iptables -L -n         # Проверка firewall
mtr target_ip
```

